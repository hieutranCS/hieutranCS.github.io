<!DOCTYPE html>
<html lang="en">
<head>
<title>Heat Map</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="icon" type="image/jpg"  href="icon.jpg">

</head>

<style >

body {
  text-align: center;
  font-family: "Helvetica", sans-serif;
  padding-top: 50px;  
}


.domain {
  stroke: red;
} 

#tooltip {
  position: absolute;
  padding: 0 10px;
  pointer-events: none;
  background-color: white;
  color: red;
  line-height: 20px;
  border-radius: 6px; 
  stroke: black;
  stroke-width: 5px;
}

.cell:hover{
  stroke: black;
  stroke-width: 2px;
}


</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.5.1/marked.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.5.1/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.5.1/marked.min.js.map"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.13.0/d3-legend.js"></script>



<body>

<div class="main">
<div class='container'>
<div id='title'> Global Temperature </div>
<div id='description'> 1753 - 2015: base temperature 8.66℃ </div>
<br>
<div class='holder'></div>
</div>
<button class="btn center-block btn-lg"  id="button"><a href="index.html"><h2>Home</h2></a></button> 
</div>


<script style="text/javascript">

var url = 'https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/global-temperature.json'

var width = 1200 - 90 - 50,
height = 550 - 30 - 100

 var chart = d3.select('.holder')
  .append('svg')
  .attr('width', 1200)
  .attr('height', 580)


d3.json(url, function(data) {

  var dataM = data.monthlyVariance
  var len = data.length

  var xScale = d3.scaleLinear()
  .domain(d3.extent(data.monthlyVariance,function(d){return d.year}))
  .range([0, width])

  var xAxis = d3.axisBottom(xScale)
  .ticks(20)
  .tickSize(15)
  .tickFormat(function(d){return d})

  var xChart = chart.append('g')
  .attr('id' ,'x-axis')
  .style("font", "15px times")
  .attr('transform', 'translate(80,430)')
  .call( xAxis )


  var yScale = d3.scaleTime()
  .domain([new Date(2015, 0, 1), new Date(2015, 11, 31)])
  .range([0, height])

  var yAxis = d3.axisLeft( yScale )
  .tickSize(15)
  .tickFormat(d3.timeFormat('%B'))


  var yChart = chart.append('g')
  .attr('id' ,'y-axis')
  .style("font", "15px times")
  .attr('transform', 'translate(80,10)')
  .call( yAxis )


  var tip = d3.tip()
  .attr('id', 'tooltip')
  .offset([-10, 0])
  .direction('e')
  .html(function(d,i) {
   return d
 })

  chart.call(tip)   

  var range = ['#5e4fa4', '#3288bd', '#66c2a5', '#abdda4', '#e6f598', '#ffffbf', '#fee08b', '#fdae61', '#f46d43', '#d53e4f', '#9e0142']


  var color = d3.scaleQuantize()
  .domain(d3.extent(dataM, function(d, i){
    var temp = data.baseTemperature + d.variance
    return temp
  }))
  .range(range)

  var map = chart.selectAll(".heat-map")
  .data(data.monthlyVariance)
  .enter()
  .append("rect")
  .attr("class", "cell")
  .attr('data-month', function(d, i) {
   return d.month -1 
 })
  .attr('data-year', function(d, i) {
   return d.year
 })
  .attr('data-temp', function(d, i) {
    return d.variance + data.baseTemperature
  })
  .attr('x', function(d){
    return xScale(d.year)+ 80
  })
  .attr('y', function(d){
    return (d.month -1) * 34 + 9
  })  
  .attr('width', 4)
  .attr('height', 47)
  .attr("fill", function(d){
    var temp = data.baseTemperature + d.variance
    return color(temp)
  })
  .on('mouseover', function(d, i){
    var tooltip =   d3.timeFormat("%B")(new Date(d.year, d.month - 1)) + " - " + d3.timeFormat("%Y")(new Date(d.year, d.month - 1)) + "<br>"
    + "temperature : " + d3.format(".1f")(data.baseTemperature + d.variance) + "℃" + "<br>"
    + "variance : " + d3.format("+.1f")(d.variance) + "℃" 

    tip.attr("data-year", d.year)
    tip.show(tooltip)
  })
  .on('mouseout', tip.hide)



  var legend = chart.append("g")
  .attr("id", "legend")
  .attr("transform", "translate(50,480)")

  var legendLinear = d3.legendColor()
  .shapeWidth(100)
  .cells(11)
  .orient('horizontal')
  .scale(color)

  var legendCall = chart.select("#legend")
  .call(legendLinear)

})


</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</body>
</html>